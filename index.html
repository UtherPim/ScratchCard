<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=0" />
<link rel="stylesheet" href="./index.css">
<script src="jquery.min.js"></script>
<script src="vue.js"></script>
<title>抽奖</title>
<script>
$(function(){
    var xcItemWidth = $('.main-content .lottery-item .xcLottery').width();
    var itemArr = $('.lottery-item')
    var lotteryIsDownArr = []
    var lotteryCanvasArr = []
    var lotteryContextArr = []
    for(var l = 1;l <= itemArr.length;l++){
        var xcobj = null;
        var canvas = document.getElementById('xcShadow' + l);
        lotteryCanvasArr.push(canvas)
        var xcobj = canvas.getContext('2d');
        lotteryContextArr.push(xcobj)
        xcobj.fillStyle='#666';
        lotteryIsDownArr.push(false)
        var isDown = false; 
        //用像素点大小的方形铺满div
        for(x=0; x<=xcItemWidth; x++){
            for(y=0; y<= 40; y++) {
                xcobj.fillRect(x,y,1,1);
            }
        }
    }

    $(".xcLottery").mousedown(function(e) {
        var thisIndex = $.inArray(this, $(".xcLottery"))
        lotteryIsDownArr[thisIndex] = true; 
    })

    //PC端效果
    $(".xcLottery").mousemove(function(e){
        // console.log(e)
        var posX = $(this).offset().left, posY = $(this).offset().top;
        var thisIndex = $.inArray(this, $(".xcLottery"))
        if(lotteryIsDownArr[thisIndex]){
            $(this).css("background", "#fff");
            lotteryContextArr[thisIndex].clearRect(event.pageX - posX,event.pageY - posY, 5, 5);
        }
    });
    
    //判断移动版的情况
    if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
        $(".xcLottery").bind('touchmove', function(e){
            e.preventDefault();
            var touch = e.originalEvent.touches[0] || e.originalEvent.changedTouches[0];
            var posX = $(this).offset().left, posY = $(this).offset().top;
            var thisIndex = $.inArray(this, $(".xcLottery"))
            if(lotteryIsDownArr[thisIndex]){
                $(this).css("background", "#fff");
                lotteryContextArr[thisIndex].clearRect(event.pageX - posX,event.pageY - posY, 5, 5);
            }
            // $(this).css("background", "#fff");
            // xcobj.clearRect(touch.pageX - posX,touch.pageY - posY, 5, 5);
        });
    } 
    
});

</script>
</head>

<body>
    <div id="app">
        <div class="main-content">
            <div class="lottery-item">
                <div @click="setAward(0)" class="setClass">...</div>
                <div class="lottery-item-text"><b>刮 一 刮</b></div>
                <div class="xcLottery">
                    {{award[0]}}
                    <canvas class="xcShadow" id="xcShadow1" :width="canvasWidth" height="40">对不起您的设备不支持canvas!</canvas>
                </div>  
            </div>
            <div class="lottery-item">
                <div @click="setAward(1)" class="setClass">...</div>
                <div class="lottery-item-text"><b>刮 一 刮</b></div>
                <div class="xcLottery">
                    {{award[1]}}
                    <canvas  class="xcShadow" id="xcShadow2" :width="canvasWidth" height="40">对不起您的设备不支持canvas!</canvas>
                </div>  
            </div>
            <div class="lottery-item">
                <div @click="setAward(2)" class="setClass">...</div>
                <div class="lottery-item-text"><b>刮 一 刮</b></div>
                <div class="xcLottery">
                    {{award[2]}}
                    <canvas class="xcShadow" id="xcShadow3" :width="canvasWidth" height="40">对不起您的设备不支持canvas!</canvas>
                </div>  
            </div>
            <div class="lottery-item">
                <div @click="setAward(3)" class="setClass">...</div>
                <div class="lottery-item-text"><b>刮 一 刮</b></div>
                <div class="xcLottery">
                    {{award[3]}}
                    <canvas  class="xcShadow" id="xcShadow4" :width="canvasWidth" height="40">对不起您的设备不支持canvas!</canvas>
                </div>  
            </div>
            <div class="lottery-item">
                <div @click="setAward(4)" class="setClass">...</div>
                <div class="lottery-item-text"><b>刮 一 刮</b></div>
                <div class="xcLottery">
                    {{award[4]}}
                    <canvas  class="xcShadow" id="xcShadow5" :width="canvasWidth" height="40">对不起您的设备不支持canvas!</canvas>
                </div>  
            </div>
            <div class="lottery-item">
                <div @click="setAward(5)" class="setClass">...</div>
                <div class="lottery-item-text"><b>刮 一 刮</b></div>
                <div class="xcLottery">
                    {{award[5]}}
                    <canvas  class="xcShadow" id="xcShadow6" :width="canvasWidth" height="40">对不起您的设备不支持canvas!</canvas>
                </div>  
            </div>
            <div class="lottery-item">
                <div @click="setAward(6)" class="setClass">...</div>
                <div class="lottery-item-text"><b>刮 一 刮</b></div>
                <div class="xcLottery">
                    {{award[6]}}
                    <canvas  class="xcShadow" id="xcShadow7" :width="canvasWidth" height="40">对不起您的设备不支持canvas!</canvas>
                </div>  
            </div>
            <div class="lottery-item">
                <div @click="setAward(7)" class="setClass">...</div>
                <div class="lottery-item-text"><b>刮 一 刮</b></div>
                <div class="xcLottery">
                    {{award[7]}}
                    <canvas  class="xcShadow" id="xcShadow8" :width="canvasWidth" height="40">对不起您的设备不支持canvas!</canvas>
                </div>  
            </div>
            <div class="lottery-item">
                <div @click="setAward(8)" class="setClass">...</div>
                <div class="lottery-item-text"><b>刮 一 刮</b></div>
                <div class="xcLottery">
                    {{award[8]}}
                    <canvas  class="xcShadow" id="xcShadow9" :width="canvasWidth" height="40">对不起您的设备不支持canvas!</canvas>
                </div>  
            </div>
            <div class="lottery-item">
                <div @click="setAward(9)" class="setClass">...</div>
                <div class="lottery-item-text"><b>刮 一 刮</b></div>
                <div class="xcLottery">
                    {{award[9]}}
                    <canvas  class="xcShadow" id="xcShadow10" :width="canvasWidth" height="40">对不起您的设备不支持canvas!</canvas>
                </div>  
            </div>
        </div>
        <div class="mask" v-show="isDisplay">
            <input type="text" placeholder="请输入奖项名" style="width: 100%;height: 24px;padding: 5px;font-size: 24px;" v-model="awardText" @keyup.enter="submit">
        </div>
    </div>
</body>
<script>
    new Vue({
        el: '#app',
        data: {
            isDisplay: false,
            awardText: '',
            award: ['试卷两张', '扫地三天', '抄课文两篇', '跑操场5圈', '免寒假作业', '免寒假作业', '免寒假作业', '免寒假作业', '免寒假作业', '表演才艺'],
            whoIsSelected: 0,
            canvasWidth: 150
        },
        mounted(){
            var xcItemWidth = $('.main-content .lottery-item .xcLottery').width();
            this.canvasWidth = xcItemWidth
            window.document.body.onresize = function() {
                location.reload()
            }
        },
        methods: {
            setAward(index) {
                this.isDisplay = true
                this.awardText = ''
                this.whoIsSelected = index
                console.log(index)
            },
            submit() {
                if(this.awardText){
                    this.award[this.whoIsSelected] = this.awardText
                    this.isDisplay = false
                }else {
                    this.isDisplay = false
                }
                
            }
        }
    })
</script>
</html>
